import pefile
from Crypto.Cipher import ARC4
import struct

SAMPLE = b'warzone.bin'

with open(SAMPLE, 'rb') as f:
    pe = pefile.PE(data=f.read())

for s in pe.sections:
    if s.Name == b'.bss\x00\x00\x00\x00':
        section_data = s.get_data()

key_size = struct.unpack('<I', section_data[:4])[0]
key = section_data[4: key_size + 4]
ct = section_data[key_size+4:].split(b'\x00\x00\x00\x00\x00\x00\x00\x00')[0]
cipher = ARC4.new(key)
pt = cipher.decrypt(ct)

c2_ip_len = struct.unpack('<I', pt[:4])[0]
c2_ip = pt[4: c2_ip_len + 4].decode('utf-16-le')
c2_port = struct.unpack('<H', pt[c2_ip_len+4:c2_ip_len+6])[0]
print(f"C2: {c2_ip}:{c2_port}")
