import pefile

with open("squirrel.bin", "rb") as f:
    data = f.read()

pe = pefile.PE(data=data)

for s in pe.sections:
    if b".rdata" in s.Name:
        rdata = s.get_data()


def decrypt(data, key):
    out = ''
    for i in range(len(data)):
        out += chr(data[i] ^ key[i % len(key)])
    return out


blobs = [blob for blob in rdata.split(b'\x00') if blob]
blobs_sorted = sorted(blobs, key=len, reverse=True)

for i in range(len(blobs)):
    if blobs[i] == blobs_sorted[0]:
        print(decrypt(blobs[i], blobs[i+1]))
        print(f"Key: {blobs[i+1].decode('utf-8')}\n")

for i in range(len(blobs)):
    if blobs[i] == blobs_sorted[1]:
        print("\n".join(decrypt(blobs[i], blobs[i+1]).split("|")))
        print(f"Key: {blobs[i+1].decode('utf-8')}\n")
